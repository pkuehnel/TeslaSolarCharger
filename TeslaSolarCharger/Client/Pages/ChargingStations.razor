@page "/ChargingStations"
@using TeslaSolarCharger.Client.Services.Contracts
@using TeslaSolarCharger.Shared.Dtos.ChargingStation
@using TeslaSolarCharger.Shared.Localization
@using TeslaSolarCharger.Shared.Localization.Contracts
@using TeslaSolarCharger.Shared.Localization.Registries
@using TeslaSolarCharger.Shared.Localization.Registries.Pages
@using Microsoft.AspNetCore.Components

@inject IChargingStationsService ChargingStationsService
@inject ITextLocalizationService TextLocalizer

<h1>@T(TranslationKeys.ChargingStationsTitle)</h1>

<MudAlert Severity="Severity.Info"
          NoIcon="true"
          ContentAlignment="HorizontalAlignment.Left">
    <h5>@T(TranslationKeys.ChargingStationsHowToConnectTitle)</h5>
    <div>@T(TranslationKeys.ChargingStationsHowToConnectContent)</div>
    <div>@((MarkupString)T(TranslationKeys.ChargingStationsHowToConnectUrlFormat))</div>
    <div>@((MarkupString)T(TranslationKeys.ChargingStationsHowToConnectNote))</div>
    <div>@((MarkupString)T(TranslationKeys.ChargingStationsHowToConnectExample))</div>
</MudAlert>

@if (_chargingStations == default)
{

    <PlaceholderComponent Count="5"></PlaceholderComponent>
}
else if (_chargingStations.Count == 0)
{
    <h3>@T(TranslationKeys.ChargingStationsNoStationsFound)</h3>
}
else
{
    foreach (var chargingStation in _chargingStations)
    {
        <div class="shadow p-3 mb-5 bg-white rounded">
            <MudText Typo="Typo.h6" GutterBottom="true">
                @chargingStation.ChargepointId
                @if (chargingStation.IsConnected)
                {
                    <MudChip T="string" Text='@T(TranslationKeys.ChargingStationsConnectedViaOcpp)' Color="Color.Success" Size="Size.Small" Class="ml-2" />
                }
                else
                {
                    <MudChip T="string" Text='@T(TranslationKeys.ChargingStationsNotConnectedViaOcpp)' Color="Color.Error" Size="Size.Small" Class="ml-2" />
                }
            </MudText>
            <ChargingStationConnectorsComponent ChargingStationId="chargingStation.Id"
                                                AutoPhaseSwitchingSupported="@(chargingStation.CanSwitchBetween1And3Phases == true)"
                                                IsOcppConnected="chargingStation.IsConnected"></ChargingStationConnectorsComponent>
        </div>
    }
}


@code {
    private List<DtoChargingStation>? _chargingStations;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        await RefreshChargingStations();

    }

    private async Task RefreshChargingStations()
    {
        _chargingStations = await ChargingStationsService.GetChargingStations();
    }

    private string T(string key) =>
        TextLocalizer.Get<ChargingStationsPageLocalizationRegistry>(key, typeof(SharedComponentLocalizationRegistry))
        ?? key;
}
